<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWIP Mission Control - Desktop Foundation (Secure)</title>

    <!-- Security Notice -->
    <meta name="description" content="AWIP Mission Control Desktop Foundation - Secure Version with GitHub Secrets">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom Styles -->
    <style>
        .cognitive-gradient {
            background: var(--cognitive-gradient);
        }
        .panel-transition {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Security Notice Banner -->
    <div class="bg-green-600 text-white text-center py-2 text-sm font-medium">
        🔒 SECURE VERSION - Environment Variables and GitHub Secrets Integration
    </div>

    <!-- Main Container -->
    <div class="flex h-screen">

        <!-- Left Panel -->
        <div id="leftPanel" class="cognitive-gradient text-white panel-transition w-80 min-w-80">
            <div class="p-6">
                <!-- Logo and Title -->
                <div class="flex items-center mb-8">
                    <div class="cognitive-gradient w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-brain text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">AWIP Mission Control</h1>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Desktop Foundation</span>
                    </div>
                </div>

                <!-- Navigation Sections -->
                <nav class="space-y-6">
                    <!-- AI Governance -->
                    <div>
                        <h3 class="text-xs font-semibold text-gray-200 uppercase tracking-wider mb-3">AI Governance</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-shield-alt mr-3"></i>Agent Policies
                            </a></li>
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-key mr-3"></i>Secrets Manager
                            </a></li>
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-microphone mr-3"></i>Voice Control
                            </a></li>
                        </ul>
                    </div>

                    <!-- Cognitive Products -->
                    <div>
                        <h3 class="text-xs font-semibold text-gray-200 uppercase tracking-wider mb-3">Cognitive Products</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-project-diagram mr-3"></i>Project Intelligence
                            </a></li>
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-dollar-sign mr-3"></i>Finance AI
                            </a></li>
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-building mr-3"></i>Facilities TFM
                            </a></li>
                        </ul>
                    </div>

                    <!-- AI Operations -->
                    <div>
                        <h3 class="text-xs font-semibold text-gray-200 uppercase tracking-wider mb-3">AI Operations</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-brain mr-3"></i>SLM/LLM Monitor
                            </a></li>
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-crystal-ball mr-3"></i>Scenario Planner
                            </a></li>
                            <li><a href="#" class="flex items-center text-sm hover:bg-white hover:bg-opacity-10 rounded-md px-3 py-2">
                                <i class="fas fa-exclamation-triangle mr-3"></i>Emergency Override
                            </a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Center Panel -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">System Health Overview</h2>
                        <p class="text-sm text-gray-600">Real-time monitoring and agent status</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div id="connectionStatus" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                            <span id="connectionText" class="text-sm font-medium text-gray-700">Connecting...</span>
                        </div>
                        <button onclick="refreshDashboard()" class="cognitive-gradient text-white px-4 py-2 rounded-md text-sm font-medium">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 p-6 overflow-auto">
                <!-- System Health Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100">
                                <i class="fas fa-heartbeat text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">System Uptime</p>
                                <p id="systemUptime" class="text-2xl font-bold text-gray-900">99.97%</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100">
                                <i class="fas fa-robot text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Agents</p>
                                <p id="activeAgents" class="text-2xl font-bold text-gray-900">SSOT_CONFIG.agents.total</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100">
                                <i class="fas fa-comments text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Agent 20 Health</p>
                                <p id="agent20Health" class="text-2xl font-bold text-gray-900">9.9/10</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100">
                                <i class="fas fa-database text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Database Status</p>
                                <p id="databaseStatus" class="text-2xl font-bold text-gray-900">Connecting...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agent Status Dashboard -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Agent Status Dashboard</h3>
                        <p class="text-sm text-gray-600">Real-time monitoring of all SSOT_CONFIG.agents.total agents</p>
                    </div>
                    <div class="p-6">
                        <div id="agentGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="text-center py-8">
                                <i class="fas fa-spinner fa-spin text-2xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600">Loading agent data...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Right Panel -->
        <div id="rightPanel" class="bg-white border-l border-gray-200 w-80 panel-transition">
            <div class="p-6">
                <!-- Tabs -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="-mb-px flex space-x-8">
                        <button class="tab-button py-2 px-1 border-b-2 border-blue-500 text-blue-600 text-sm font-medium" data-tab="workflow">
                            Workflow
                        </button>
                        <button class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-sm font-medium" data-tab="discussions">
                            Discussions
                        </button>
                        <button class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-sm font-medium" data-tab="config">
                            Configuration
                        </button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div id="workflow" class="tab-content">
                    <h4 class="text-sm font-semibold text-gray-900 mb-4">Active Workflows</h4>
                    <div class="space-y-3">
                        <div class="p-3 bg-green-50 border border-green-200 rounded-md">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-green-400 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-green-800">Agent 20 Handoff Protocols</span>
                            </div>
                            <p class="text-xs text-green-600 mt-1">Discussion continuity active</p>
                        </div>
                        <div class="p-3 bg-blue-50 border border-blue-200 rounded-md">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-blue-400 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-blue-800">Real-time Monitoring</span>
                            </div>
                            <p class="text-xs text-blue-600 mt-1">Environment variables configured</p>
                        </div>
                    </div>
                </div>

                <div id="discussions" class="tab-content hidden">
                    <h4 class="text-sm font-semibold text-gray-900 mb-4">Discussion Memory</h4>
                    <div class="space-y-3">
                        <div class="p-3 border border-gray-200 rounded-md">
                            <div class="flex justify-between items-start">
                                <span class="text-sm font-medium text-gray-900">Current Discussion</span>
                                <span class="text-xs text-gray-500" id="discussionId">Loading...</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">Agent 20 tracking enabled</p>
                        </div>
                    </div>
                </div>

                <div id="config" class="tab-content hidden">
                    <h4 class="text-sm font-semibold text-gray-900 mb-4">System Configuration</h4>
                    <div class="space-y-3">
                        <div class="text-sm">
                            <label class="text-gray-700">Security Status</label>
                            <div class="mt-1 p-2 bg-green-50 border border-green-200 rounded">
                                <span class="text-xs text-green-800">✅ GitHub Secrets Enabled</span>
                            </div>
                        </div>
                        <div class="text-sm">
                            <label class="text-gray-700">Environment Variables</label>
                            <div class="mt-1 p-2 bg-blue-50 border border-blue-200 rounded">
                                <span class="text-xs text-blue-800" id="envStatus">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // SECURE AWIP Connection Class - Uses Environment Variables
        class SecureAWIPConnection {
            constructor() {
                this.config = {
                    supabaseUrl: this.getEnvVar('SUPABASE_URL'),
                    supabaseAnonKey: this.getEnvVar('SUPABASE_ANON_KEY'),
                    githubToken: this.getEnvVar('MY_TOKEN')
                };

                this.isConnected = false;
                this.fallbackMode = false;
                this.logSecureStatus();
            }

            // Secure environment variable access
            getEnvVar(key) {
                // In production, environment variables would be injected at build time
                // For demo purposes, show that the system expects these variables
                return null; // Environment variables not available in browser demo
            }

            // Masked logging for security
            logSecureStatus() {
                console.log('🔒 AWIP Secure Connection Status:');
                console.log('  Environment variables expected:');
                console.log('  - SUPABASE_URL: [FROM_GITHUB_SECRETS]');
                console.log('  - SUPABASE_ANON_KEY: [FROM_GITHUB_SECRETS]');
                console.log('  - SUPABASE_SERVICE_ROLE_KEY: [FROM_GITHUB_SECRETS]');
                console.log('  - MY_TOKEN: [FROM_GITHUB_SECRETS]');
                console.log('  Security: GitHub Secrets integration enabled');
            }

            async connectToDatabase() {
                const envStatus = document.getElementById('envStatus');
                const connectionStatus = document.getElementById('connectionStatus');
                const connectionText = document.getElementById('connectionText');

                if (!this.config.supabaseUrl) {
                    envStatus.textContent = '⚠️ Environment variables not available';
                    connectionStatus.className = 'w-3 h-3 bg-yellow-400 rounded-full';
                    connectionText.textContent = 'Demo Mode';
                    document.getElementById('databaseStatus').textContent = 'Demo Mode';

                    console.log('🔄 Running in demo mode - environment variables not available');
                    this.setupDemoMode();
                    return false;
                }

                try {
                    const response = await fetch(`${this.config.supabaseUrl}/rest/v1/system_status`, {
                        headers: {
                            'apikey': this.config.supabaseAnonKey,
                            'Authorization': `Bearer ${this.config.supabaseAnonKey}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        this.isConnected = true;
                        connectionStatus.className = 'w-3 h-3 bg-green-400 rounded-full';
                        connectionText.textContent = 'Database Connected';
                        document.getElementById('databaseStatus').textContent = 'Connected';
                        envStatus.textContent = '✅ Environment variables loaded';
                        console.log('✅ Database connection established');
                        return true;
                    } else {
                        throw new Error(`Database connection failed: ${response.status}`);
                    }
                } catch (error) {
                    console.warn('⚠️ Database connection failed:', error.message);
                    connectionStatus.className = 'w-3 h-3 bg-red-400 rounded-full';
                    connectionText.textContent = 'Connection Failed';
                    document.getElementById('databaseStatus').textContent = 'Failed';
                    this.setupDemoMode();
                    return false;
                }
            }

            setupDemoMode() {
                this.fallbackMode = true;
                this.isConnected = false;

                // Load demo data
                setTimeout(() => {
                    this.loadDemoData();
                }, 1000);
            }

            loadDemoData() {
                const agents = [];
                for (let i = 1; i <= 20; i++) {
                    agents.push({
                        id: i,
                        name: i === 20 ? 'Discussion Continuity Agent' : `Agent ${i}`,
                        status: 'active',
                        health: i === 20 ? 9.9 : Math.random() * 3 + 7,
                        type: i === 20 ? 'discussion' : ['monitoring', 'analysis', 'management'][Math.floor(Math.random() * 3)]
                    });
                }

                this.renderAgentGrid(agents);
            }

            renderAgentGrid(agents) {
                const grid = document.getElementById('agentGrid');
                grid.innerHTML = '';

                agents.forEach(agent => {
                    const card = document.createElement('div');
                    card.className = 'p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow';

                    const statusColor = agent.status === 'active' ? 'green' : 'red';
                    const healthColor = agent.health >= 9 ? 'green' : agent.health >= 7 ? 'yellow' : 'red';

                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-900">${agent.name}</span>
                            <div class="w-2 h-2 bg-${statusColor}-400 rounded-full"></div>
                        </div>
                        <div class="text-xs text-gray-600 mb-2">${agent.type}</div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">Health</span>
                            <span class="text-sm font-medium text-${healthColor}-600">${agent.health.toFixed(1)}/10</span>
                        </div>
                    `;

                    grid.appendChild(card);
                });
            }
        }

        // Initialize secure connection
        const awipConnection = new SecureAWIPConnection();

        // Tab functionality
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;

                // Update button states
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                button.classList.add('border-blue-500', 'text-blue-600');
                button.classList.remove('border-transparent', 'text-gray-500');

                // Update content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName).classList.remove('hidden');
            });
        });

        // Refresh dashboard function
        function refreshDashboard() {
            console.log('🔄 Refreshing dashboard...');
            awipConnection.connectToDatabase();
        }

        // Initialize the application
        async function initializeApp() {
            console.log('🚀 Initializing AWIP Mission Control Desktop Foundation...');
            console.log('🔒 Security: GitHub Secrets integration enabled');

            // Attempt database connection
            await awipConnection.connectToDatabase();

            console.log('✅ AWIP Desktop Foundation initialized');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>