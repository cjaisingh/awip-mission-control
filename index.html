<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWIP Mission Control - Desktop Foundation</title>

    <!-- Tailwind CSS 2.2.19 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome 6.4.0 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* AWIP Cognitive Gradient Theme */
        .cognitive-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Three-panel layout */
        .three-panel-layout {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            height: 100vh;
            overflow: hidden;
        }

        .panel-collapsed {
            width: 60px;
        }

        .panel-transition {
            transition: all 0.3s ease;
        }

        /* Panel styles */
        .left-panel, .right-panel {
            overflow-y: auto;
            border-right: 1px solid #e5e7eb;
        }

        .right-panel {
            border-left: 1px solid #e5e7eb;
            border-right: none;
        }

        .center-panel {
            overflow-y: auto;
            background-color: #f9fafb;
        }

        /* Agent status cards */
        .agent-card {
            transition: all 0.2s ease;
        }

        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .three-panel-layout {
                grid-template-columns: 60px 1fr 60px;
            }
        }

        /* Loading animations */
        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="cognitive-gradient text-white px-6 py-3 shadow-sm">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-brain text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">AWIP Mission Control</h1>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Desktop Foundation</span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full pulse-animation"></div>
                    <span class="text-sm">System Operational</span>
                </div>
                <button id="togglePanels" class="p-2 hover:bg-white hover:bg-opacity-20 rounded">
                    <i class="fas fa-expand-arrows-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main three-panel layout -->
    <div class="three-panel-layout">
        <!-- Left Panel: Navigation and Cognitive Domains -->
        <div id="leftPanel" class="left-panel bg-white panel-transition">
            <div class="p-4">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Cognitive Domains</h3>

                <!-- AI Governance Section -->
                <div class="mb-4">
                    <button class="flex items-center w-full text-left p-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-md">
                        <i class="fas fa-shield-alt text-purple-600 mr-3"></i>
                        <span>AI Governance</span>
                        <i class="fas fa-chevron-right ml-auto text-xs"></i>
                    </button>
                    <div class="ml-8 mt-2 space-y-1">
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Agent Policies</a>
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Secrets Manager</a>
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Voice Control</a>
                    </div>
                </div>

                <!-- Cognitive Products Section -->
                <div class="mb-4">
                    <button class="flex items-center w-full text-left p-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-md">
                        <i class="fas fa-chart-line text-blue-600 mr-3"></i>
                        <span>Cognitive Products</span>
                        <i class="fas fa-chevron-right ml-auto text-xs"></i>
                    </button>
                    <div class="ml-8 mt-2 space-y-1">
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Project Intelligence</a>
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Finance AI</a>
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Facilities TFM</a>
                    </div>
                </div>

                <!-- AI Operations Section -->
                <div class="mb-4">
                    <button class="flex items-center w-full text-left p-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-md">
                        <i class="fas fa-brain text-green-600 mr-3"></i>
                        <span>AI Operations</span>
                        <i class="fas fa-chevron-right ml-auto text-xs"></i>
                    </button>
                    <div class="ml-8 mt-2 space-y-1">
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">SLM/LLM Monitor</a>
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Scenario Planner</a>
                        <a href="#" class="block p-2 text-sm text-gray-600 hover:bg-gray-50 rounded">Emergency Override</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Main Dashboard and Monitoring -->
        <div class="center-panel">
            <div class="p-6">
                <!-- System Health Overview -->
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">System Health Overview</h2>
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <!-- System Status Card -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check text-green-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-900">System Status</p>
                                    <p id="systemStatus" class="text-sm text-gray-600">Loading...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Agent Count Card -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-users text-blue-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-900">Active Agents</p>
                                    <p id="agentCount" class="text-sm text-gray-600">Loading...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Uptime Card -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-clock text-purple-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-900">Uptime</p>
                                    <p id="systemUptime" class="text-sm text-gray-600">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agent Status Dashboard -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Agent Status Dashboard</h3>
                        <button id="refreshAgents" class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">
                            <i class="fas fa-sync-alt mr-1"></i> Refresh
                        </button>
                    </div>

                    <!-- Agent Grid -->
                    <div id="agentGrid" class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <!-- Agent cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Agent 20 Spotlight -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 cognitive-gradient rounded-lg flex items-center justify-center">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-lg font-semibold text-gray-900">Agent 20: Discussion Continuity</h3>
                            <p class="text-sm text-gray-600">Handoff protocols and context management</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-green-600" id="agent20Health">9.9</p>
                            <p class="text-sm text-gray-600">Health Score</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-600" id="agent20Status">Active</p>
                            <p class="text-sm text-gray-600">Status</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-purple-600" id="agent20Handoffs">Enabled</p>
                            <p class="text-sm text-gray-600">Handoff Protocols</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Context and Tools -->
        <div id="rightPanel" class="right-panel bg-white panel-transition">
            <div class="p-4">
                <!-- Tab Navigation -->
                <div class="flex border-b border-gray-200 mb-4">
                    <button class="tab-button px-3 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600" data-tab="workflow">
                        Workflow
                    </button>
                    <button class="tab-button px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="discussions">
                        Discussions
                    </button>
                    <button class="tab-button px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="config">
                        Config
                    </button>
                </div>

                <!-- Workflow Tab -->
                <div id="workflowTab" class="tab-content">
                    <h4 class="text-sm font-semibold text-gray-900 mb-3">Current Workflow</h4>
                    <div class="space-y-3">
                        <div class="p-3 bg-green-50 border border-green-200 rounded">
                            <p class="text-sm font-medium text-green-800">âœ… Database Connected</p>
                            <p class="text-xs text-green-600">Supabase integration operational</p>
                        </div>
                        <div class="p-3 bg-blue-50 border border-blue-200 rounded">
                            <p class="text-sm font-medium text-blue-800">ðŸ”„ Foundation Deployed</p>
                            <p class="text-xs text-blue-600">Desktop interface active</p>
                        </div>
                        <div class="p-3 bg-yellow-50 border border-yellow-200 rounded">
                            <p class="text-sm font-medium text-yellow-800">âš¡ Agent 20 Ready</p>
                            <p class="text-xs text-yellow-600">Handoff protocols enabled</p>
                        </div>
                    </div>
                </div>

                <!-- Discussions Tab -->
                <div id="discussionsTab" class="tab-content hidden">
                    <h4 class="text-sm font-semibold text-gray-900 mb-3">Discussion Memory</h4>
                    <div class="space-y-2">
                        <div class="p-2 bg-gray-50 rounded text-sm">
                            <p class="text-gray-600">Current: Database integration complete</p>
                        </div>
                        <div class="p-2 bg-gray-50 rounded text-sm">
                            <p class="text-gray-600">Context: Desktop foundation deployed</p>
                        </div>
                    </div>
                </div>

                <!-- Configuration Tab -->
                <div id="configTab" class="tab-content hidden">
                    <h4 class="text-sm font-semibold text-gray-900 mb-3">System Configuration</h4>
                    <div class="space-y-2">
                        <div class="text-sm">
                            <p class="text-gray-600">Database: <span class="text-green-600">Connected</span></p>
                            <p class="text-gray-600">Agents: <span class="text-blue-600">20 Active</span></p>
                            <p class="text-gray-600">Health: <span class="text-purple-600">99.97%</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AWIP Desktop Foundation JavaScript
        const SUPABASE_URL = 'https://nkjckkaqcdscrtzmmyyt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ramNra2FxY2RzY3J0em1teXl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NzYyMzEsImV4cCI6MjA2NDU1MjIzMX0.hZ0ZT3EQ-glhTh7uELLcxDyuptp0syvcoNmgqv1JxfQ';

        // Supabase headers
        const headers = {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json'
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            loadAgentData();
            setupEventListeners();
            startRealTimeUpdates();
        });

        // Load system status from database
        async function loadSystemStatus() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/system_status?system_name=eq.AWIP`, {
                    headers: headers
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.length > 0) {
                        const systemData = data[0];
                        document.getElementById('systemStatus').textContent = systemData.status || 'Unknown';
                        document.getElementById('systemUptime').textContent = `${systemData.uptime_percentage || 0}%`;
                        document.getElementById('agentCount').textContent = systemData.agent_count || '0';
                    }
                } else {
                    console.error('Failed to load system status');
                    showFallbackData();
                }
            } catch (error) {
                console.error('Error loading system status:', error);
                showFallbackData();
            }
        }

        // Load agent data from database
        async function loadAgentData() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agents?select=*&order=id`, {
                    headers: headers
                });

                if (response.ok) {
                    const agents = await response.json();
                    displayAgents(agents);

                    // Update Agent 20 specifically
                    const agent20 = agents.find(a => a.id === 20);
                    if (agent20) {
                        document.getElementById('agent20Health').textContent = agent20.health_score || '9.9';
                        document.getElementById('agent20Status').textContent = agent20.status || 'Active';
                    }
                } else {
                    console.error('Failed to load agent data');
                    showFallbackAgents();
                }
            } catch (error) {
                console.error('Error loading agent data:', error);
                showFallbackAgents();
            }
        }

        // Display agents in grid
        function displayAgents(agents) {
            const agentGrid = document.getElementById('agentGrid');
            agentGrid.innerHTML = '';

            agents.forEach(agent => {
                const agentCard = createAgentCard(agent);
                agentGrid.appendChild(agentCard);
            });
        }

        // Create agent card element
        function createAgentCard(agent) {
            const card = document.createElement('div');
            card.className = 'agent-card bg-white p-4 rounded-lg shadow-sm border hover:shadow-md transition-all';

            const statusColor = agent.status === 'active' ? 'green' : 'gray';
            const healthScore = agent.health_score || 0;
            const healthColor = healthScore > 8 ? 'green' : healthScore > 5 ? 'yellow' : 'red';

            card.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-${statusColor}-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-robot text-${statusColor}-600"></i>
                        </div>
                        <span class="ml-2 text-sm font-medium text-gray-900">Agent ${agent.id}</span>
                    </div>
                    <div class="w-2 h-2 bg-${statusColor}-400 rounded-full"></div>
                </div>
                <h4 class="text-sm font-semibold text-gray-800 mb-1">${agent.name || 'Unknown Agent'}</h4>
                <p class="text-xs text-gray-600 mb-2">${agent.type || 'No type specified'}</p>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-${statusColor}-600 font-medium">${agent.status || 'Unknown'}</span>
                    <span class="text-xs text-${healthColor}-600 font-medium">${healthScore}/10</span>
                </div>
            `;

            return card;
        }

        // Show fallback data when database fails
        function showFallbackData() {
            document.getElementById('systemStatus').textContent = 'Operational';
            document.getElementById('systemUptime').textContent = '99.97%';
            document.getElementById('agentCount').textContent = '20';
        }

        // Show fallback agents when database fails
        function showFallbackAgents() {
            const fallbackAgents = [
                {id: 1, name: 'DevOps Agent', type: 'monitoring', status: 'active', health_score: 8.5},
                {id: 2, name: 'Database Agent', type: 'management', status: 'active', health_score: 9.2},
                {id: 20, name: 'Discussion Continuity Agent', type: 'analysis', status: 'active', health_score: 9.9}
            ];
            displayAgents(fallbackAgents);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // Panel toggle
            document.getElementById('togglePanels').addEventListener('click', togglePanels);

            // Refresh button
            document.getElementById('refreshAgents').addEventListener('click', function() {
                loadSystemStatus();
                loadAgentData();
            });
        }

        // Switch tabs in right panel
        function switchTab(tabName) {
            // Update button states
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });

            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-blue-500', 'text-blue-600');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
        }

        // Toggle panel collapse
        function togglePanels() {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            leftPanel.classList.toggle('panel-collapsed');
            rightPanel.classList.toggle('panel-collapsed');
        }

        // Start real-time updates
        function startRealTimeUpdates() {
            // Update every 30 seconds
            setInterval(() => {
                loadSystemStatus();
                loadAgentData();
            }, 30000);
        }

        // Add console message for debugging
        console.log('AWIP Desktop Foundation initialized successfully');
        console.log('Database URL:', SUPABASE_URL);
        console.log('Real-time updates active');
    </script>
</body>
</html>